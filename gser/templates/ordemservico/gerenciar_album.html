{% extends "mobile_menu_base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Gerenciar 츼lbum{% endblock %}
{% block extra_head %}
<style>
  #dropzone {
  border: 2px dashed #ccc;
  padding: 20px;
  cursor: pointer;
  background-color: #f8f9fa;
}
#dropzone:hover {
  background-color: #e9ecef;
}

</style>
{% endblock %}
{% block content %}
<div class="container py-4">

  <!-- Cabe칞alho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0"><i class="fa fa-image me-2"></i> Gerenciar 츼lbum: {{ album.nome }}</h4>
    
    <!-- Topo: Voltar + Excluir (desktop) -->
<div class="d-none d-md-flex justify-content-between align-items-center mb-4">
  <a href="{% url 'listar_albuns' album.servico.ordem.id album.servico.id %}" class="btn btn-outline-secondary">
    <i class="fa fa-arrow-left"></i> Voltar aos 츼lbuns
  </a>

  <form method="post" action="{% url 'excluir_album' album.id %}"
        onsubmit="return confirm('Tem certeza que deseja excluir este 치lbum e todas as fotos nele?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-outline-danger">
      <i class="fa fa-trash"></i> Excluir 츼lbum
    </button>
  </form>
</div>

  </div>

  <!-- 游님 Mobile: dois formul치rios separados -->
  <div class="d-block d-md-none">
    <div class="mb-3">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="imagem" accept="image/*" capture="environment" class="d-none" id="camera-input">
        <input type="hidden" name="legenda" value="">
        <button type="button" class="btn btn-outline-primary w-100 mb-2" onclick="document.getElementById('camera-input').click();">
          <i class="fa fa-camera"></i> Tirar Foto com a C칙mera
        </button>
        <button type="submit" class="btn btn-primary w-100">
          <i class="fa fa-upload"></i> Enviar
        </button>
      </form>
    </div>

    <div class="mb-4">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="imagem" accept="image/*" class="form-control mb-2" required>
        <input type="text" name="legenda" class="form-control" placeholder="Legenda (opcional)">
        <button type="submit" class="btn btn-success w-100 mt-2">
          <i class="fa fa-image"></i> Fazer Upload da Galeria
        </button>
      </form>
    </div>
  </div>

  <!-- 游눹 Desktop: arrastar e soltar m칰ltiplas imagens -->
<div class="d-none d-md-block mb-4">
  <form method="post" enctype="multipart/form-data" class="card card-body shadow-sm">
    {% csrf_token %}
    <div class="mb-3">
      <label class="form-label">Selecionar ou Arrastar Imagens</label>
      <input type="file" name="imagem" accept="image/*" class="form-control" multiple id="dropzone">
    </div>

    <div class="mb-3">
      <label class="form-label">Legenda (opcional - ser치 usada em todas)</label>
      <input type="text" name="legenda" class="form-control">
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-primary">
        <i class="fa fa-upload"></i> Enviar Fotos
      </button>
    </div>
  </form>
</div>


  <!-- Lista de Fotos -->
  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <strong>Fotos no 츼lbum</strong>
    </div>
    <div class="card-body">
      {% if fotos %}
        <div class="row">
          {% for foto in fotos %}
            
          

            <div class="col-6 col-md-3 mb-4 text-center">

  <!-- Imagem com clique para modal -->
  <a href="#" data-bs-toggle="modal" data-bs-target="#fotoModal{{ foto.id }}">
    <img src="{{ foto.imagem.url }}" alt="Foto" class="img-fluid rounded mb-2" />
  </a>

  {% if foto.legenda %}
    <p class="small text-muted">{{ foto.legenda }}</p>
  {% endif %}

  <!-- Bot칚o excluir -->
  <form method="post" action="{% url 'excluir_foto' foto.id %}" onsubmit="return confirm('Deseja excluir esta foto?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-sm btn-outline-danger">
      <i class="fa fa-trash"></i> Excluir
    </button>
  </form>

  <!-- Modal -->
  <div class="modal fade" id="fotoModal{{ foto.id }}" tabindex="-1" aria-labelledby="modalLabel{{ foto.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalLabel{{ foto.id }}">{{ foto.legenda|default:"" }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body text-center">
          <img src="{{ foto.imagem.url }}" alt="Foto ampliada" class="img-fluid rounded">
        </div>
      </div>
    </div>
  </div>

</div>


          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">Nenhuma foto neste 치lbum ainda.</p>
      {% endif %}
    </div>
  </div>


  <!-- Bot칚o excluir no mobile -->
<div class="d-md-none mt-4">
  <form method="post" action="{% url 'excluir_album' album.id %}"
        onsubmit="return confirm('Tem certeza que deseja excluir este 치lbum e todas as fotos nele?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger w-100">
      <i class="fa fa-trash"></i> Excluir 츼lbum
    </button>
  </form>
</div>


  <!-- Bot칚o Voltar: mobile -->
  <div class="d-md-none mt-4">
    <a href="{% url 'listar_albuns' album.servico.ordem.id album.servico.id %}" class="btn btn-outline-secondary w-100">
        <i class="fa fa-arrow-left"></i> Voltar
      </a>
  </div>

</div>
{% endblock %}
