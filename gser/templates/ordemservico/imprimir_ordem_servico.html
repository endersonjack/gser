{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Imprimir Ordem de Serviço</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    @media print {
      .no-print { display: none; }
    }
    .quadro-ocorrencias {
      border: 1px dashed #000;
      height: 180px;
      padding: 10px;
      margin-bottom: 20px;
    }
    .assinaturas {
      display: flex;
      justify-content: space-between;
      margin-top: 60px;
    }
    .assinatura-bloco {
      width: 45%;
      text-align: center;
    }
    .linha-assinatura {
      border-top: 1px solid #000;
      margin-top: 60px;
    }
    .logo { max-height: 80px; }
    .card-impressao { border: 1px solid #000; padding: 20px; }
    .form-check { margin-bottom: 8px; }
    .foto-preview {
      max-height: 100px;
      margin: 5px;
      border: 1px solid #ddd;
    }
    .titulo-secao {
      background: #f0f0f0;
      padding: 5px 10px;
      font-weight: bold;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
  </style>
</head>
<body class="container my-4">

  <!-- Cabeçalho com logo e contrato -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <img src="{% static 'imagens/logo.png' %}" alt="Logo" class="logo">
    <div>
      <h5 class="mb-0">Ordem de Serviço</h5>
      <small><strong>Empresa:</strong> Nome da Empresa</small><br>
      <small><strong>Órgão:</strong> {{ ordem.contrato.orgao_nome }}</small><br>
      <small><strong>Contrato:</strong> {{ ordem.contrato.numero }}</small>
    </div>
  </div>

  <!-- Dados da OS -->
  <div class="card-impressao mb-3">
    <div class="row">
      <div class="col-md-4"><strong>Nº OS:</strong> {{ ordem.numero_formatado }}</div>
      <div class="col-md-8"><strong>Local:</strong> {{ ordem.local.nome }}</div>
      <div class="col-md-12"><strong>Endereço:</strong> {{ ordem.local.endereco }}</div>
      <div class="col-md-6"><strong>Data de Início:</strong> {{ ordem.data_inicio|date:"d/m/Y" }}</div>
      {% if ordem.data_termino %}
      <div class="col-md-6"><strong>Data de Término:</strong> {{ ordem.data_termino|date:"d/m/Y" }}</div>
      {% endif %}
    </div>
  </div>

  <!-- Seleção de serviços e fotos -->
  <div>
    <div class="titulo-secao">Serviços Selecionados</div>
    {% for servico in ordem.servicos.all %}
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="servico{{ servico.id }}">
        <label class="form-check-label" for="servico{{ servico.id }}">
          {{ servico.descricao }} ({{ servico.categoria.nome }})
        </label>
      </div>
      {% for album in servico.albuns.all %}
        <div class="ms-4 form-check">
          <input class="form-check-input" type="checkbox" id="album{{ album.id }}">
          <label class="form-check-label" for="album{{ album.id }}">
            Álbum: {{ album.nome }}
          </label>
          <div class="d-flex flex-wrap">
            {% for foto in album.fotos.all|slice:":3" %}
              <img src="{{ foto.imagem.url }}" alt="Foto" class="foto-preview">
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    {% endfor %}
  </div>

  <!-- Observações -->
  {% if ordem.observacao %}
  <div class="titulo-secao">Observações</div>
  <div class="card card-body mb-4">
    {{ ordem.observacao }}
  </div>
  {% endif %}

  <!-- Ocorrências -->
  <div class="titulo-secao">Ocorrências</div>
  <div class="quadro-ocorrencias"></div>

  <!-- Local e Data -->
  <div class="text-end mb-4">
    <strong>Local e Data:</strong> ____________________________________, {{ hoje|date:"d/m/Y" }}
  </div>

  <!-- Assinaturas -->
  <div class="assinaturas">
    <div class="assinatura-bloco">
      <div class="linha-assinatura"></div>
      <small>Assinatura da Empresa</small>
    </div>
    <div class="assinatura-bloco">
      <div class="linha-assinatura"></div>
      <small>Assinatura do Funcionário</small>
    </div>
  </div>

  <!-- Rodapé Final -->
  <div class="text-center mt-5">
    <p class="mb-0">Serviço finalizado em: _____ / _____ / _____</p>
    <div class="linha-assinatura mt-5"></div>
    <small>Assinatura da Direção / Responsável</small>
  </div>

  <!-- Botão para imprimir -->
  <div class="text-center mt-4 no-print">
    <button class="btn btn-primary" onclick="window.print()">
      <i class="fa fa-print"></i> Imprimir
    </button>
  </div>

</body>
</html>
